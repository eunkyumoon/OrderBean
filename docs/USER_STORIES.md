# OrderBean 사용자 스토리 (Gherkin Style)

> Given-When-Then 형식의 구체적이고 테스트 가능한 사용자 스토리

---

## 1. 메뉴 조회 및 검색 (고객 기능)

### Story 1.1: 카테고리별 메뉴 조회

```gherkin
Feature: 카테고리별 메뉴 조회
  As a 고객
  I want to 카테고리별로 메뉴를 조회하고 싶다
  So that 원하는 종류의 메뉴를 빠르게 찾을 수 있다

  Scenario: 커피 카테고리 메뉴 조회
    Given 시스템에 "커피" 카테고리의 메뉴가 5개 등록되어 있다
    And 시스템에 "차" 카테고리의 메뉴가 3개 등록되어 있다
    When 고객이 "커피" 카테고리로 필터링하여 메뉴를 조회한다
    Then "커피" 카테고리의 메뉴 5개만 반환된다
    And 각 메뉴의 카테고리는 "coffee"이다
    And 페이지네이션 정보가 포함되어 있다
```

### Story 1.2: 키워드로 메뉴 검색

```gherkin
Feature: 키워드 메뉴 검색
  As a 고객
  I want to 키워드로 메뉴를 검색하고 싶다
  So that 메뉴명이나 설명으로 원하는 메뉴를 찾을 수 있다

  Scenario: 메뉴명으로 검색
    Given 시스템에 "카페 라떼", "아메리카노", "카푸치노" 메뉴가 등록되어 있다
    When 고객이 "라떼" 키워드로 검색한다
    Then "카페 라떼" 메뉴만 반환된다
    And 검색 결과는 메뉴명에 "라떼"를 포함한다

  Scenario: 설명으로 검색
    Given "카페 라떼" 메뉴의 설명이 "부드러운 우유와 에스프레소"이다
    When 고객이 "에스프레소" 키워드로 검색한다
    Then "카페 라떼" 메뉴가 검색 결과에 포함된다
```

### Story 1.3: 메뉴 상세 정보 조회

```gherkin
Feature: 메뉴 상세 정보 조회
  As a 고객
  I want to 메뉴의 상세 정보를 확인하고 싶다
  So that 주문 전 가격과 옵션을 정확히 파악할 수 있다

  Scenario: 메뉴 상세 정보 조회 성공
    Given 시스템에 ID가 1인 "카페 라떼" 메뉴가 등록되어 있다
    And 메뉴의 가격은 4500원이다
    And 메뉴에 샷, 우유, 시럽 옵션이 설정되어 있다
    When 고객이 메뉴 ID 1의 상세 정보를 조회한다
    Then 메뉴명, 가격, 설명이 반환된다
    And 커스터마이징 옵션 정보가 포함되어 있다
      | 옵션 | 기본값 | 최대값 | 추가 가격 |
      | 샷 | 1 | 5 | 500원 |
      | 우유 | 일반우유 | - | - |
      | 시럽 | 0펌프 | 5펌프 | 0원 |

  Scenario: 존재하지 않는 메뉴 조회
    Given 시스템에 ID가 999인 메뉴가 존재하지 않는다
    When 고객이 메뉴 ID 999의 상세 정보를 조회한다
    Then 404 에러가 반환된다
    And 에러 메시지는 "메뉴를 찾을 수 없습니다"이다
```

---

## 2. 커스터마이징 주문 및 결제 (고객 기능)

### Story 2.1: 옵션 커스터마이징 주문

```gherkin
Feature: 커스터마이징 주문 생성
  As a 고객
  I want to 메뉴 옵션을 커스터마이징하여 주문하고 싶다
  So that 나만의 취향에 맞는 커피를 주문할 수 있다

  Scenario: 샷 추가 주문
    Given 고객이 로그인되어 있다
    And "카페 라떼" 메뉴의 기본 가격은 4500원이다
    And 샷 추가 가격은 500원이다
    When 고객이 "카페 라떼"를 선택하고
    And 샷을 2개로 설정하고
    And 수량을 1개로 설정하여 주문한다
    Then 주문이 생성된다
    And 주문 금액은 5000원이다 (4500 + 500)
    And 주문 항목의 커스터마이징에 샷 2개가 포함된다

  Scenario: 우유 종류 변경 주문
    Given 고객이 로그인되어 있다
    And "카페 라떼" 메뉴의 기본 우유는 "일반우유"이다
    When 고객이 "카페 라떼"를 선택하고
    And 우유 종류를 "오트밀크"로 변경하고
    And 주문한다
    Then 주문이 생성된다
    And 주문 항목의 커스터마이징에 우유 "오트밀크"가 포함된다

  Scenario: 시럽 추가 주문
    Given 고객이 로그인되어 있다
    And "카페 라떼" 메뉴의 시럽 추가는 0원이다
    When 고객이 "카페 라떼"를 선택하고
    And 시럽 종류를 "바닐라"로 선택하고
    And 펌프를 2개로 설정하여 주문한다
    Then 주문이 생성된다
    And 주문 항목의 커스터마이징에 시럽 정보가 포함된다
      | 종류 | 펌프 |
      | 바닐라 | 2 |
```

### Story 2.2: 장바구니 주문

```gherkin
Feature: 장바구니를 통한 다중 메뉴 주문
  As a 고객
  I want to 여러 메뉴를 장바구니에 담아 한 번에 주문하고 싶다
  So that 여러 음료를 효율적으로 주문할 수 있다

  Scenario: 여러 메뉴 주문
    Given 고객이 로그인되어 있다
    And 장바구니에 "아메리카노" 1개(4000원)가 담겨 있다
    When 고객이 "카페 라떼" 2개(4500원)를 추가로 담고
    And 주문한다
    Then 주문이 생성된다
    And 주문 항목은 2개이다
    And 총 주문 금액은 13000원이다 (4000 + 4500*2)
```

### Story 2.3: 결제 처리

```gherkin
Feature: 모바일 선결제
  As a 고객
  I want to 주문 전에 결제를 완료하고 싶다
  So that 매장 도착 시 즉시 픽업할 수 있다

  Scenario: 카드 결제 성공
    Given 고객이 로그인되어 있다
    And 장바구니에 총 5000원 상당의 메뉴가 담겨 있다
    And 고객의 카드 정보가 등록되어 있다
    When 고객이 "카드" 결제 수단을 선택하고
    And 주문을 완료한다
    Then 결제가 처리된다
    And 주문 상태는 "접수"이다
    And 결제 상태는 "completed"이다

  Scenario: 결제 실패 시 주문 생성 안됨
    Given 고객이 로그인되어 있다
    And 장바구니에 메뉴가 담겨 있다
    When 고객이 주문을 시도하지만
    And 결제가 실패한다
    Then 주문이 생성되지 않는다
    And 에러 메시지는 "결제 처리에 실패했습니다"이다
```

### Story 2.4: 매장 선택

```gherkin
Feature: 매장 선택
  As a 고객
  I want to 픽업할 매장을 선택하고 싶다
  So that 가까운 매장에서 주문을 받을 수 있다

  Scenario: 매장 선택 주문
    Given 시스템에 "강남점", "홍대점" 매장이 등록되어 있다
    And 고객이 로그인되어 있다
    When 고객이 "강남점"을 선택하고
    And 메뉴를 주문한다
    Then 주문이 생성된다
    And 주문의 매장 ID는 "강남점"의 ID이다
```

---

## 3. 주문 내역 및 레시피 관리 (고객 기능)

### Story 3.1: 주문 내역 조회

```gherkin
Feature: 주문 내역 조회
  As a 고객
  I want to 과거 주문 내역을 조회하고 싶다
  So that 주문한 메뉴와 옵션을 확인할 수 있다

  Scenario: 주문 목록 조회
    Given 고객이 로그인되어 있다
    And 고객의 과거 주문이 5건 있다
    When 고객이 주문 목록을 조회한다
    Then 최근 주문순으로 5건의 주문이 반환된다
    And 각 주문에는 주문 번호, 날짜, 총액, 상태가 포함된다

  Scenario: 상태별 주문 필터링
    Given 고객이 로그인되어 있다
    And 고객의 주문 중 "접수" 상태가 2건, "제조 완료" 상태가 3건 있다
    When 고객이 "제조 완료" 상태로 필터링하여 조회한다
    Then "제조 완료" 상태의 주문 3건만 반환된다
```

### Story 3.2: 주문 상세 조회

```gherkin
Feature: 주문 상세 정보 조회
  As a 고객
  I want to 주문의 상세 정보를 확인하고 싶다
  So that 주문한 메뉴와 옵션을 정확히 확인할 수 있다

  Scenario: 본인 주문 상세 조회
    Given 고객이 로그인되어 있다
    And 고객의 주문 번호 101이 존재한다
    And 주문에는 "카페 라떼" 1개(샷 2개, 오트밀크)가 포함되어 있다
    When 고객이 주문 번호 101의 상세 정보를 조회한다
    Then 주문 정보가 반환된다
    And 주문 항목에 메뉴명, 수량, 커스터마이징 옵션이 포함된다
    And 커스터마이징 옵션에 샷 2개, 우유 "오트밀크"가 표시된다

  Scenario: 다른 사용자 주문 조회 시도
    Given 고객 A가 로그인되어 있다
    And 고객 B의 주문 번호 102가 존재한다
    When 고객 A가 주문 번호 102의 상세 정보를 조회한다
    Then 403 에러가 반환된다
    And 에러 메시지는 "주문을 조회할 권한이 없습니다"이다
```

### Story 3.3: 나만의 레시피 저장

```gherkin
Feature: 나만의 레시피 저장
  As a 고객
  I want to 자주 주문하는 메뉴와 옵션을 레시피로 저장하고 싶다
  So that 빠르게 재주문할 수 있다

  Scenario: 레시피 생성
    Given 고객이 로그인되어 있다
    And "카페 라떼" 메뉴가 존재한다
    When 고객이 "카페 라떼"에
    And 샷 2개, 우유 "오트밀크", 시럽 "바닐라" 2펌프를 설정하고
    And 레시피 이름을 "힘찬 아침 레시피"로 저장한다
    Then 레시피가 생성된다
    And 레시피 이름은 "힘찬 아침 레시피"이다
    And 레시피에 저장된 커스터마이징 옵션이 정확하다

  Scenario: 레시피 이름 중복 방지
    Given 고객이 로그인되어 있다
    And 고객에게 이미 "힘찬 아침 레시피"라는 이름의 레시피가 있다
    When 고객이 같은 이름으로 레시피를 저장하려고 한다
    Then 레시피가 생성되지 않는다
    And 에러 메시지는 "레시피 이름이 이미 존재합니다"이다
```

### Story 3.4: 원클릭 재주문

```gherkin
Feature: 레시피로 재주문
  As a 고객
  I want to 저장된 레시피로 한 번의 클릭으로 재주문하고 싶다
  So that 주문 시간을 단축할 수 있다

  Scenario: 레시피로 주문 생성
    Given 고객이 로그인되어 있다
    And 고객에게 "힘찬 아침 레시피" 레시피가 저장되어 있다
    And 레시피는 "카페 라떼"에 샷 2개, 오트밀크 옵션이 설정되어 있다
    When 고객이 "힘찬 아침 레시피"를 선택하고
    And 재주문 버튼을 클릭한다
    Then 주문이 생성된다
    And 주문 항목의 옵션이 레시피와 동일하다
    And 주문 금액이 정확히 계산된다

  Scenario: 최근 주문으로 재주문
    Given 고객이 로그인되어 있다
    And 고객의 최근 주문에 "아메리카노" 2개가 포함되어 있다
    When 고객이 최근 주문에서 "재주문" 버튼을 클릭한다
    Then 동일한 메뉴와 옵션으로 주문이 생성된다
```

### Story 3.5: 주문 상태 실시간 확인

```gherkin
Feature: 주문 상태 확인
  As a 고객
  I want to 주문 상태를 실시간으로 확인하고 싶다
  So that 픽업 시기를 파악할 수 있다

  Scenario: 주문 상태 변경 알림
    Given 고객이 주문 번호 101을 주문했다
    And 주문 상태는 "접수"이다
    When 관리자가 주문 상태를 "제조 중"으로 변경한다
    Then 고객의 주문 목록에서 주문 상태가 "제조 중"으로 표시된다

  Scenario: 제조 완료 알림
    Given 고객이 주문 번호 101을 주문했다
    And 주문 상태는 "제조 중"이다
    When 관리자가 주문 상태를 "제조 완료"로 변경한다
    Then 고객에게 픽업 알림이 전송된다
    And 주문 목록에서 주문 상태가 "제조 완료"로 표시된다
```

---

## 4. 메뉴 관리 (관리 기능)

### Story 4.1: 메뉴 등록

```gherkin
Feature: 메뉴 등록
  As a 관리자
  I want to 새로운 메뉴를 등록하고 싶다
  So that 신규 메뉴를 판매할 수 있다

  Scenario: 메뉴 등록 성공
    Given 관리자가 로그인되어 있다
    When 관리자가 다음 정보로 메뉴를 등록한다
      | 필드 | 값 |
      | 이름 | 새 메뉴 |
      | 설명 | 신규 메뉴 설명 |
      | 가격 | 5000 |
      | 카테고리 | coffee |
      | 판매 가능 | true |
    Then 메뉴가 생성된다
    And 메뉴 ID가 할당된다
    And 등록된 메뉴 정보가 정확하다

  Scenario: 필수 필드 누락 시 에러
    Given 관리자가 로그인되어 있다
    When 관리자가 이름 없이 메뉴를 등록하려고 한다
    Then 메뉴가 생성되지 않는다
    And 에러 메시지는 "필수 필드가 누락되었습니다"이다
```

### Story 4.2: 메뉴 수정

```gherkin
Feature: 메뉴 정보 수정
  As a 관리자
  I want to 메뉴 정보를 수정하고 싶다
  So that 가격이나 설명을 업데이트할 수 있다

  Scenario: 메뉴 가격 수정
    Given 관리자가 로그인되어 있다
    And ID가 1인 "카페 라떼" 메뉴의 가격은 4500원이다
    When 관리자가 메뉴 ID 1의 가격을 5000원으로 수정한다
    Then 메뉴 가격이 5000원으로 업데이트된다
    And 수정 시간이 기록된다

  Scenario: 존재하지 않는 메뉴 수정 시도
    Given 관리자가 로그인되어 있다
    And ID가 999인 메뉴가 존재하지 않는다
    When 관리자가 메뉴 ID 999를 수정하려고 한다
    Then 404 에러가 반환된다
```

### Story 4.3: 메뉴 삭제

```gherkin
Feature: 메뉴 삭제
  As a 관리자
  I want to 메뉴를 삭제하고 싶다
  So that 판매 중지된 메뉴를 제거할 수 있다

  Scenario: 메뉴 삭제 성공
    Given 관리자가 로그인되어 있다
    And ID가 1인 메뉴가 존재한다
    When 관리자가 메뉴 ID 1을 삭제한다
    Then 메뉴가 삭제된다
    And 메뉴 목록에서 해당 메뉴가 제거된다

  Scenario: 판매 중인 메뉴 삭제 방지
    Given 관리자가 로그인되어 있다
    And ID가 1인 메뉴에 활성 주문이 있다
    When 관리자가 메뉴 ID 1을 삭제하려고 한다
    Then 메뉴가 삭제되지 않는다
    And 에러 메시지는 "활성 주문이 있는 메뉴는 삭제할 수 없습니다"이다
```

### Story 4.4: 메뉴 옵션 설정

```gherkin
Feature: 메뉴 커스터마이징 옵션 설정
  As a 관리자
  I want to 메뉴의 커스터마이징 옵션을 설정하고 싶다
  So that 고객이 다양한 옵션을 선택할 수 있다

  Scenario: 샷 옵션 설정
    Given 관리자가 로그인되어 있다
    And ID가 1인 메뉴가 존재한다
    When 관리자가 메뉴 ID 1에 샷 옵션을 설정한다
      | 기본값 | 최소값 | 최대값 | 추가 가격 |
      | 1 | 1 | 5 | 500 |
    Then 샷 옵션이 저장된다
    And 고객이 주문 시 샷 옵션을 선택할 수 있다

  Scenario: 우유 종류 옵션 설정
    Given 관리자가 로그인되어 있다
    And ID가 1인 메뉴가 존재한다
    When 관리자가 메뉴 ID 1에 우유 종류 옵션을 설정한다
      | 종류 |
      | 일반우유 |
      | 오트밀크 |
      | 두유 |
    Then 우유 종류 옵션이 저장된다
```

### Story 4.5: 판매 가능 여부 관리

```gherkin
Feature: 메뉴 판매 가능 여부 관리
  As a 관리자
  I want to 메뉴의 판매 가능 여부를 제어하고 싶다
  So that 재고 상황에 따라 메뉴를 활성화/비활성화할 수 있다

  Scenario: 메뉴 판매 중지
    Given 관리자가 로그인되어 있다
    And ID가 1인 메뉴가 판매 가능 상태이다
    When 관리자가 메뉴 ID 1을 판매 중지한다
    Then 메뉴의 is_available이 false로 변경된다
    And 고객이 메뉴 목록에서 해당 메뉴를 볼 수 없다

  Scenario: 판매 중지된 메뉴 주문 방지
    Given ID가 1인 메뉴가 판매 중지 상태이다
    And 고객이 로그인되어 있다
    When 고객이 메뉴 ID 1을 주문하려고 한다
    Then 주문이 생성되지 않는다
    And 에러 메시지는 "판매 중지된 메뉴입니다"이다
```

---

## 5. 주문 상태 관리 및 통계 (관리 기능)

### Story 5.1: 주문 상태 업데이트

```gherkin
Feature: 주문 상태 관리
  As a 관리자
  I want to 주문 상태를 업데이트하고 싶다
  So that 고객에게 주문 진행 상황을 알릴 수 있다

  Scenario: 주문 상태 변경 (접수 → 제조 중)
    Given 관리자가 로그인되어 있다
    And 주문 번호 101의 상태는 "접수"이다
    When 관리자가 주문 번호 101의 상태를 "제조 중"으로 변경한다
    Then 주문 상태가 "제조 중"으로 업데이트된다
    And 업데이트 시간이 기록된다
    And 고객의 주문 목록에서 상태가 "제조 중"으로 표시된다

  Scenario: 주문 상태 변경 (제조 중 → 제조 완료)
    Given 관리자가 로그인되어 있다
    And 주문 번호 101의 상태는 "제조 중"이다
    When 관리자가 주문 번호 101의 상태를 "제조 완료"로 변경한다
    Then 주문 상태가 "제조 완료"로 업데이트된다
    And 고객에게 픽업 알림이 전송된다

  Scenario: 잘못된 상태 값으로 변경 시도
    Given 관리자가 로그인되어 있다
    And 주문 번호 101이 존재한다
    When 관리자가 주문 상태를 "잘못된 상태"로 변경하려고 한다
    Then 주문 상태가 변경되지 않는다
    And 에러 메시지는 "유효하지 않은 주문 상태입니다"이다
```

### Story 5.2: 주문 목록 조회

```gherkin
Feature: 관리자 주문 목록 조회
  As a 관리자
  I want to 주문 목록을 조회하고 싶다
  So that 처리해야 할 주문을 확인할 수 있다

  Scenario: 상태별 주문 필터링
    Given 관리자가 로그인되어 있다
    And 시스템에 "접수" 상태 주문 3건, "제조 중" 상태 주문 2건이 있다
    When 관리자가 "접수" 상태로 필터링하여 조회한다
    Then "접수" 상태의 주문 3건만 반환된다

  Scenario: 시간별 주문 조회
    Given 관리자가 로그인되어 있다
    And 오늘 생성된 주문이 10건, 어제 생성된 주문이 5건 있다
    When 관리자가 오늘 날짜로 필터링하여 조회한다
    Then 오늘 생성된 주문 10건만 반환된다
```

### Story 5.3: 매출 통계 조회

```gherkin
Feature: 매출 통계 조회
  As a 관리자
  I want to 매출 통계를 조회하고 싶다
  So that 매장 운영 현황을 파악할 수 있다

  Scenario: 일별 매출 조회
    Given 관리자가 로그인되어 있다
    And 2024-12-15에 주문 5건이 있고 총 매출이 25000원이다
    When 관리자가 2024-12-15의 일별 매출을 조회한다
    Then 총 매출 25000원이 반환된다
    And 주문 건수 5건이 반환된다

  Scenario: 월별 매출 조회
    Given 관리자가 로그인되어 있다
    And 2024년 12월에 총 매출이 500000원이고 주문 건수가 100건이다
    When 관리자가 2024년 12월의 월별 매출을 조회한다
    Then 총 매출 500000원이 반환된다
    And 주문 건수 100건이 반환된다
    And 일별 매출 추이 데이터가 포함된다
```

### Story 5.4: 인기 메뉴 분석

```gherkin
Feature: 인기 메뉴 통계
  As a 관리자
  I want to 인기 메뉴 통계를 확인하고 싶다
  So that 인기 메뉴를 파악하여 재고 관리에 활용할 수 있다

  Scenario: 인기 메뉴 조회
    Given 관리자가 로그인되어 있다
    And "카페 라떼"가 50회 주문되었고
    And "아메리카노"가 30회 주문되었고
    And "카푸치노"가 20회 주문되었다
    When 관리자가 인기 메뉴 통계를 조회한다
    Then 메뉴별 주문 횟수가 반환된다
    And "카페 라떼"가 1위로 표시된다
    And 주문 횟수 순으로 정렬된다

  Scenario: 기간별 인기 메뉴 조회
    Given 관리자가 로그인되어 있다
    And 지난 주에 "카페 라떼"가 20회 주문되었다
    And 이번 주에 "아메리카노"가 25회 주문되었다
    When 관리자가 이번 주 기간으로 인기 메뉴를 조회한다
    Then 이번 주 주문 데이터만 반환된다
    And "아메리카노"가 1위로 표시된다
```

### Story 5.5: 주문 취소 처리

```gherkin
Feature: 주문 취소 처리
  As a 관리자
  I want to 주문을 취소하고 싶다
  So that 고객 요청이나 문제 발생 시 주문을 취소할 수 있다

  Scenario: 접수 상태 주문 취소
    Given 관리자가 로그인되어 있다
    And 주문 번호 101의 상태는 "접수"이다
    And 주문 금액은 5000원이다
    And 결제가 완료된 상태이다
    When 관리자가 주문 번호 101을 취소한다
    Then 주문 상태가 "취소"로 변경된다
    And 환불 처리가 진행된다
    And 환불 금액은 5000원이다

  Scenario: 제조 중인 주문 취소 방지
    Given 관리자가 로그인되어 있다
    And 주문 번호 101의 상태는 "제조 중"이다
    When 관리자가 주문 번호 101을 취소하려고 한다
    Then 주문이 취소되지 않는다
    And 에러 메시지는 "제조가 시작된 주문은 취소할 수 없습니다"이다
```

---

## 테스트 실행 방법

이 사용자 스토리는 다음 도구로 테스트할 수 있습니다:

- **Cucumber**: Gherkin 스타일 테스트 실행
- **Jest + Supertest**: API 통합 테스트
- **E2E 테스트**: Playwright, Cypress 등

---

## 관련 문서

- [기능 요구사항](./FUNCTIONAL_REQUIREMENTS.md)
- [API 문서](./API.md)
- [테스트 가이드](./TESTING.md)

---

**마지막 업데이트**: 2024-12-16

